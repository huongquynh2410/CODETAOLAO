<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bulls & Cows — Trò chơi đoán số</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--accent:linear-gradient(90deg,#7c3aed,#06b6d4);} 
    body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
    .glass{backdrop-filter: blur(6px) saturate(120%); background-color: rgba(255,255,255,0.06);}
    .digit-btn{width:48px;height:48px;border-radius:12px;display:inline-grid;place-items:center;font-weight:600}
    .pulse-appear{animation:pulseAppear .28s ease-out}
    @keyframes pulseAppear{from{opacity:0;transform:translateY(6px) scale(.98)}to{opacity:1;transform:none}}
    #confettiCanvas{position:fixed;left:0;top:0;pointer-events:none;z-index:60}
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-950 text-slate-100 antialiased">
  <canvas id="confettiCanvas"></canvas>
  <main class="max-w-4xl mx-auto p-6">
    <header class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-extrabold tracking-tight">Bulls & Cows</h1>
      <div class="flex gap-2">
        <button id="guideBtn" class="px-3 py-1 rounded-md bg-slate-700 text-white hover:bg-slate-600">Hướng dẫn</button>
        <button id="newGameBtn" class="px-3 py-1 rounded-md bg-gradient-to-r from-violet-600 to-cyan-500 text-white shadow-lg hover:scale-105 transition-transform">Game mới</button>
        <button id="surrenderBtn" class="px-3 py-1 rounded-md bg-red-600 hover:bg-red-500 text-white shadow-lg">Đầu hàng</button>
      </div>
    </header>

    <section class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="md:col-span-2 glass p-4 rounded-2xl shadow-lg">
        <div class="flex items-center justify-between mb-4">
          <div>
            <div class="text-sm text-slate-300">Độ dài dãy</div>
            <div class="mt-1 flex items-center gap-3">
              <label class="flex items-center gap-1"><input id="len4" type="radio" name="len" value="4" checked class="accent-violet-500" />4</label>
              <label class="flex items-center gap-1"><input id="len5" type="radio" name="len" value="5" class="accent-violet-500" />5</label>
            </div>
          </div>
          <div class="text-right">
            <div class="text-sm text-slate-300">Lượt dùng</div>
            <div id="attempts" class="text-lg font-semibold">0</div>
          </div>
        </div>

        <div class="mb-4">
          <div class="text-slate-300 text-sm">Nhập đoán</div>
          <div id="currentGuess" class="mt-2 flex gap-2 items-center"></div>
          <div class="mt-3 flex gap-2 items-center">
            <input id="typedInput" inputmode="numeric" pattern="[0-9]*" maxlength="5" class="w-full p-3 rounded-xl bg-slate-900 border border-slate-800 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-violet-500" />
            <button id="submitGuess" class="px-4 py-2 rounded-xl bg-violet-600 text-white font-semibold">Gửi</button>
            <button id="backBtn" class="px-3 py-2 rounded-xl glass border border-slate-700">Xóa</button>
          </div>
        </div>

        <div class="grid grid-cols-10 gap-2 mt-3" id="digitPad"></div>

        <div class="mt-6">
          <div class="text-slate-300 text-sm mb-2">Lịch sử đoán</div>
          <div id="history" class="space-y-3 max-h-64 overflow-auto pr-2"></div>
        </div>
      </div>

      <aside class="glass p-4 rounded-2xl shadow-lg">
        <h2 class="font-semibold mb-2">Trạng thái</h2>
        <div id="status" class="text-slate-400 text-sm mb-4">Sẵn sàng chơi — nhấn "Game mới" để bắt đầu.</div>
        <button id="copyHistory" class="w-full py-2 rounded-xl bg-slate-700 hover:bg-slate-600">Sao chép lịch sử</button>
      </aside>
    </section>

    <footer class="mt-8 text-center text-slate-500 text-sm">
      <div>Bulls & Cows — UI hiện đại.</div>
    </footer>
  </main>

  <!-- Modal hướng dẫn -->
  <div id="guideModal" class="fixed inset-0 hidden bg-black/60 flex items-center justify-center z-50">
    <div class="bg-slate-900 p-6 rounded-2xl max-w-lg w-full shadow-2xl border border-slate-700">
      <h2 class="text-xl font-bold mb-3">Luật chơi & Mẹo</h2>
      <p class="text-slate-300 text-sm leading-relaxed mb-3">
        Trò chơi Bulls & Cows yêu cầu bạn đoán đúng dãy số bí mật gồm các chữ số khác nhau.
      </p>
      <ul class="list-disc list-inside text-slate-300 text-sm space-y-1 mb-4">
        <li>Mỗi lượt đoán sẽ được báo số <b>Bulls</b> (đúng số & đúng vị trí) và <b>Cows</b> (đúng số nhưng sai vị trí).</li>
        <li>Không có chữ số lặp lại trong dãy bí mật.</li>
        <li>Dùng thông tin từ Bulls & Cows để suy luận dãy đúng.</li>
      </ul>
      <div class="text-slate-400 text-sm mb-4">
        <b>Mẹo:</b> Bắt đầu với dãy số khác nhau hoàn toàn để loại trừ nhanh.
      </div>
      <div class="flex justify-end gap-2">
        <button id="closeGuide" class="px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600">Đóng</button>
      </div>
    </div>
  </div>

  <script>
    const DEFAULT_LEN = 4;
    let secret = '';
    let len = DEFAULT_LEN;
    let attempts = 0;
    let history = [];

    const statusEl = document.getElementById('status');
    const newGameBtn = document.getElementById('newGameBtn');
    const surrenderBtn = document.getElementById('surrenderBtn');
    const submitBtn = document.getElementById('submitGuess');
    const backBtn = document.getElementById('backBtn');
    const typedInput = document.getElementById('typedInput');
    const attemptsEl = document.getElementById('attempts');
    const historyEl = document.getElementById('history');
    const digitPad = document.getElementById('digitPad');
    const currentGuessEl = document.getElementById('currentGuess');
    const copyHistoryBtn = document.getElementById('copyHistory');
    const guideBtn = document.getElementById('guideBtn');
    const guideModal = document.getElementById('guideModal');
    const closeGuide = document.getElementById('closeGuide');

    function genSecret(n){
      const digits = '0123456789'.split('');
      let s = '';
      for(let i=0;i<n;i++){
        const idx = Math.floor(Math.random()*digits.length);
        s += digits.splice(idx,1);
      }
      return s;
    }

    function countBullsCows(secret, guess){
      let bulls = 0, cows = 0;
      for(let i=0;i<secret.length;i++) if(secret[i] === guess[i]) bulls++;
      const mapS = {}, mapG = {};
      for(const ch of secret) mapS[ch] = (mapS[ch]||0)+1;
      for(const ch of guess) mapG[ch] = (mapG[ch]||0)+1;
      for(const d in mapG) if(mapS[d]) cows += Math.min(mapG[d], mapS[d]);
      cows -= bulls;
      return {bulls,cows};
    }

    function buildDigitPad(){
      digitPad.innerHTML = '';
      for(let d=0;d<=9;d++){
        const btn = document.createElement('button');
        btn.type='button'; btn.className='digit-btn bg-slate-800 text-slate-100 border border-slate-700 hover:scale-105 transition-transform';
        btn.textContent = d;
        btn.addEventListener('click', ()=>{inputDigit(d.toString())});
        digitPad.appendChild(btn);
      }
    }

    function inputDigit(d){
      let cur = getCurrentGuess();
      if(cur.length >= len) return;
      if(cur.includes(d)) return;
      setCurrentGuess(cur + d);
    }

    function setCurrentGuess(s){
      currentGuessEl.innerHTML = '';
      for(let i=0;i<len;i++){
        const cell = document.createElement('div');
        cell.className = 'w-12 h-12 rounded-lg flex items-center justify-center bg-slate-900 border border-slate-800 text-lg font-semibold';
        if(s[i]){ cell.textContent = s[i]; cell.classList.add('pulse-appear'); }
        else cell.innerHTML = '<span class="text-slate-600">—</span>';
        currentGuessEl.appendChild(cell);
      }
      typedInput.value = s;
    }

    function getCurrentGuess(){ return typedInput.value.trim(); }

    function submitGuess(){
      const guess = getCurrentGuess();
      if(guess.length !== len) return;
      if(new Set(guess).size !== guess.length) return;
      if(!/^[0-9]+$/.test(guess)) return;

      attempts++;
      attemptsEl.textContent = attempts;
      const res = countBullsCows(secret, guess);
      history.unshift({guess,res,at:new Date()});
      renderHistory();
      setCurrentGuess('');
      statusEl.textContent = `${guess} → ${res.bulls} Bulls, ${res.cows} Cows`;

      if(res.bulls === len){
        statusEl.textContent = `Bạn đã thắng sau ${attempts} lượt!`;
        statusEl.classList.add('text-green-300');
      }
    }

    function renderHistory(){
      historyEl.innerHTML = '';
      for(const item of history){
        const row = document.createElement('div');
        row.className = 'flex items-center justify-between p-3 rounded-xl bg-slate-900 border border-slate-800 shadow-sm';
        const left = document.createElement('div');
        left.innerHTML = `<div class="font-mono text-lg">${item.guess}</div>`;
        const right = document.createElement('div');
        right.innerHTML = `<div class="text-right"><span class="inline-block px-2 py-1 rounded-md bg-slate-800 text-sm">${item.res.bulls} Bulls</span> <span class="inline-block px-2 py-1 rounded-md bg-slate-800 text-sm ml-2">${item.res.cows} Cows</span></div>`;
        row.appendChild(left); row.appendChild(right);
        historyEl.appendChild(row);
      }
    }

    function newGame(){
      const chosen = document.querySelector('input[name=len]:checked').value;
      len = parseInt(chosen,10);
      attempts = 0; history = [];
      secret = genSecret(len);
      attemptsEl.textContent = attempts;
      statusEl.textContent = `Game mới: ${len} chữ số.`;
      statusEl.classList.remove('text-green-300');
      renderHistory();
      setCurrentGuess('');
      typedInput.maxLength = len;
      typedInput.focus();
    }

    function surrender(){
      statusEl.textContent = 'Bạn đã đầu hàng! Số bí mật là: ' + secret;
      statusEl.classList.add('text-red-400');
    }

    function copyHistory(){
      if(history.length===0) return;
      let txt = `Bulls & Cows — Lịch sử (dãy ${len} chữ số)\n`;
      history.slice().reverse().forEach((h,i)=>{ txt += `${history.length-i}. ${h.guess} → ${h.res.bulls}B ${h.res.cows}C\n`; });
      navigator.clipboard.writeText(txt);
    }

    // modal hướng dẫn
    guideBtn.addEventListener('click', ()=>{ guideModal.classList.remove('hidden'); });
    closeGuide.addEventListener('click', ()=>{ guideModal.classList.add('hidden'); });
    guideModal.addEventListener('click', (e)=>{ if(e.target===guideModal) guideModal.classList.add('hidden'); });

    submitBtn.addEventListener('click', submitGuess);
    backBtn.addEventListener('click', ()=>{ let s = getCurrentGuess(); s = s.slice(0,-1); setCurrentGuess(s); });
    typedInput.addEventListener('input', (e)=>{
      let v = e.target.value.replace(/\D/g,'').slice(0,len);
      let seen = new Set(); let out='';
      for(const ch of v){ if(!seen.has(ch)){ out+=ch; seen.add(ch); } }
      e.target.value = out; setCurrentGuess(out);
    });
    typedInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') { e.preventDefault(); submitGuess(); } });

    newGameBtn.addEventListener('click', newGame);
    surrenderBtn.addEventListener('click', surrender);
    copyHistoryBtn.addEventListener('click', copyHistory);

    window.addEventListener('keydown', (e)=>{
      if(e.key >= '0' && e.key <= '9'){ inputDigit(e.key); }
      if(e.key === 'Enter') submitGuess();
      if(e.key === 'Escape') setCurrentGuess('');
      if(e.key === 'Backspace'){ let s=getCurrentGuess(); setCurrentGuess(s.slice(0,-1)); }
    });

    buildDigitPad(); newGame();
  </script>
</body>
</html>
